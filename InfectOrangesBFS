struct RottenOrange
{
    public int row;
    public int col;
    public int time;

    public RottenOrange(int row, int col, int time)
    {
        this.row = row;
        this.col = col;
        this.time = time;
    }
}

public class Solution {

    private int m;
    private int n;

    private void initializeConstraints(int[][] grid)
    {
        this.m = grid.Length;
        this.n = grid[0].Length;
    }

    private int getFreshOrangesCount(int[][] grid)
    {
        int freshOrangesCount = 0;
        for(int i=0;i<m;i++)
        {
            for(int j=0;j<n;j++)
            {
                if (grid[i][j]==1)
                {
                    freshOrangesCount++;
                }
            }
        }
        return freshOrangesCount;
    }

    public int OrangesRotting(int[][] grid) {
        initializeConstraints(grid);
        int freshOrangesCount = getFreshOrangesCount(grid);

        if (freshOrangesCount == 0)
        {
            return 0;
        }

        Queue<RottenOrange> queueOfPairs = new Queue<RottenOrange>();
 
        for (int i=0; i<m;i++)
        {
            for(int j=0;j<n;j++)
            {
                if (grid[i][j]==2)
                {
                    queueOfPairs.Enqueue(new RottenOrange(i,j,0));
                }
            }
        }
        
        if (queueOfPairs.Count == 0)
        {
            return -1;
        }

        int maxTime = 0;
        while(queueOfPairs.Count > 0)
        {
            RottenOrange rottenOrange = queueOfPairs.Dequeue();
            maxTime = Math.Max(maxTime, rottenOrange.time);
            int newInfectedOranges = InfectNearbyOranges(queueOfPairs, rottenOrange, grid);
            freshOrangesCount -= newInfectedOranges;
        }

        if(freshOrangesCount > 0)
        {
            return -1;
        }
        return maxTime;
    }

    private int InfectNearbyOranges(Queue<RottenOrange> rottenOranges, RottenOrange rottenOrange, int[][] grid)
    {
        int[] rowAdditions = {-1, 0, 1, 0};
        int[] colAdditions = {0, -1, 0, 1};
        int newInfectedOranges = 0;
        for(int i=0;i<4;i++)
        {
            int newRow = rottenOrange.row+rowAdditions[i];
            int newCol = rottenOrange.col+colAdditions[i];
            int newTime = rottenOrange.time +1;
            if(withinLimits(newRow, newCol) && grid[newRow][newCol]==1)
            {
                grid[newRow][newCol] = 2;
                rottenOranges.Enqueue(new RottenOrange(newRow, newCol, newTime));
                newInfectedOranges++;
            }
        }
        return newInfectedOranges;
    }

    private bool withinLimits(int r, int c)
    {
        if (r >= 0 && r< m && c >=0 && c<n)
        {
            return true;
        }
        return false;
    }
}
